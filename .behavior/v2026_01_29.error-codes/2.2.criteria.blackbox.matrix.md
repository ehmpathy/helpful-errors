# blackbox criteria: coverage matrix

> distilled from 2.1.criteria.blackbox.md

---

## matrix.1: default codes by error class

covers: usecase.1, usecase.2

| ind: error class        | dep: code.http | dep: code.slug |
| ----------------------- | -------------- | -------------- |
| HelpfulError            | undefined      | undefined      |
| BadRequestError         | 400            | undefined      |
| UnexpectedCodePathError | 500            | undefined      |

**note**: these are the defaults when no code is supplied at throw time.

---

## matrix.2: instance code supply

covers: usecase.3

assumes class has default `{ http: 400 }` (e.g., BadRequestError)

| ind: instance code supplied | dep: code.http | dep: code.slug |
| --------------------------- | -------------- | -------------- |
| none                        | 400 (class)    | undefined      |
| `{ slug: 'X' }`             | 400 (class)    | 'X' (instance) |
| `{ http: 422 }`             | 422 (instance) | undefined      |
| `{ http: 422, slug: 'X' }`  | 422 (instance) | 'X' (instance) |
| `null`                      | undefined      | undefined      |

**note**: instance values override class values field-by-field. `null` clears entirely.

---

## matrix.3: class inheritance

covers: usecase.5

| ind: parent (B) has code | ind: child (A) has code | dep: instance code source |
| ------------------------ | ----------------------- | ------------------------- |
| no                       | no                      | undefined                 |
| yes                      | no                      | B (inherited)             |
| no                       | yes                     | A (declared)              |
| yes                      | yes                     | A (overrides B)           |

**note**: standard js static inheritance — child shadows parent.

---

## matrix.4: merge semantics

covers: usecase.6

class code: `{ http: 400, slug: 'CLASS' }`

| ind: instance supplies http | ind: instance supplies slug | dep: final http | dep: final slug |
| --------------------------- | --------------------------- | --------------- | --------------- |
| no                          | no                          | 400             | 'CLASS'         |
| no                          | yes ('INST')                | 400             | 'INST'          |
| yes (422)                   | no                          | 422             | 'CLASS'         |
| yes (422)                   | yes ('INST')                | 422             | 'INST'          |

**note**: merge is field-by-field. instance wins per field, class fills gaps.

---

## matrix.5: partial codes

covers: usecase.7

| ind: http present | ind: slug present | dep: code valid? |
| ----------------- | ----------------- | ---------------- |
| no                | no                | yes (undefined)  |
| yes               | no                | yes              |
| no                | yes               | yes              |
| yes               | yes               | yes              |

**note**: all combinations valid. no required fields.

---

## matrix.6: serialization behavior

covers: usecase.8

| ind: slug present | ind: slug source  | dep: code in toJSON |
| ----------------- | ----------------- | ------------------- |
| no                | n/a               | omitted             |
| yes               | class static      | included            |
| yes               | instance metadata | included            |

**note**: the rule is simple — slug present → serialize code; no slug → omit code.

expanded with http source for completeness:

| ind: slug present | ind: http source    | dep: code in toJSON | dep: code.http in output |
| ----------------- | ------------------- | ------------------- | ------------------------ |
| no                | class default (400) | omitted             | n/a                      |
| no                | class default (500) | omitted             | n/a                      |
| no                | instance override   | omitted             | n/a                      |
| yes               | class default       | included            | yes                      |
| yes               | class explicit      | included            | yes                      |
| yes               | instance override   | included            | yes                      |

**note**: http source doesn't affect serialization decision — only slug presence matters.

---

## matrix.7: backwards compatibility

covers: usecase.9

| ind: code in metadata | ind: access pattern   | dep: behavior             |
| --------------------- | --------------------- | ------------------------- |
| none                  | error.message         | unchanged                 |
| none                  | error.metadata        | unchanged                 |
| none                  | error.code            | undefined (safe)          |
| none                  | JSON.stringify(error) | unchanged (no code field) |

**note**: zero breaks. code is purely additive.

---

## gap analysis

**no gaps found** — all meaningful combinations are covered.

**decomposition opportunities**: none required. each matrix has 2-3 independent dimensions, which is manageable. the largest matrix (matrix.6 expanded) has 6 rows, well within reason.

---

## summary

| matrix              | independent vars  | combinations | status   |
| ------------------- | ----------------- | ------------ | -------- |
| 1. default codes    | 1 (class)         | 3            | complete |
| 2. instance supply  | 1 (supplied)      | 5            | complete |
| 3. inheritance      | 2 (parent, child) | 4            | complete |
| 4. merge semantics  | 2 (http, slug)    | 4            | complete |
| 5. partial codes    | 2 (http, slug)    | 4            | complete |
| 6. serialization    | 2 (slug, source)  | 6            | complete |
| 7. backwards compat | 2 (code, access)  | 4            | complete |

total coverage: **30 combinations** across 7 matrices.
