# roadmap: metadata-getter

## phase.1 = core HelpfulError changes

### task.1.1 = add generic type parameter to HelpfulError class
- [ ] **execute:** modify class declaration in `src/HelpfulError.ts`
- **depends on:** none
- **acceptance criteria:**
  - `HelpfulError<TMetadata>` accepts a type parameter
  - default `= HelpfulErrorMetadata` is set
  - `extends HelpfulErrorMetadata` constraint is applied
- **verification:**
  ```sh
  npm run test:types
  ```
  - expect: no type errors in file


### task.1.2 = update constructor signature
- [ ] **execute:** change `metadata?: HelpfulErrorMetadata` to `metadata?: TMetadata`
- **depends on:** task.1.1
- **acceptance criteria:**
  - constructor accepts `TMetadata` type
  - optional metadata behavior preserved
- **verification:**
  ```sh
  npm run test:types
  ```
  - expect: no type errors


### task.1.3 = update private original property type
- [ ] **execute:** change `metadata?: HelpfulErrorMetadata` to `metadata?: TMetadata` in original type
- **depends on:** task.1.2
- **acceptance criteria:**
  - `this.original.metadata` has type `TMetadata | undefined`
- **verification:**
  ```sh
  npm run test:types
  ```
  - expect: no type errors


### task.1.4 = add public metadata getter
- [ ] **execute:** add `public get metadata(): TMetadata | undefined` to HelpfulError
- **depends on:** task.1.3
- **acceptance criteria:**
  - `error.metadata` returns the metadata object
  - `error.metadata` returns undefined when no metadata passed
  - getter is non-enumerable (does not appear in Object.keys)
- **verification:**
  ```sh
  npm run test:types
  ```
  - expect: no type errors


### task.1.5 = update static throw method signature
- [ ] **execute:** change metadata type to `InstanceType<T> extends HelpfulError<infer M> ? M : HelpfulErrorMetadata`
- **depends on:** task.1.4
- **acceptance criteria:**
  - `TypedError.throw('msg', metadata)` constrains metadata to `TMetadata`
  - `HelpfulError.throw('msg', metadata)` accepts any `HelpfulErrorMetadata`
- **verification:**
  ```sh
  npm run test:types
  ```
  - expect: no type errors


### task.1.6 = verify HelpfulError prior tests pass
- [ ] **execute:** run tests for HelpfulError
- **depends on:** task.1.5
- **acceptance criteria:**
  - all prior tests in `HelpfulError.test.ts` pass
  - no snapshot changes (backwards compat)
- **verification:**
  ```sh
  npm run test:unit -- HelpfulError.test.ts
  ```
  - expect: all tests pass


---

## phase.2 = subclass updates

### task.2.1 = update BadRequestError subclass
- [ ] **execute:** add generic type parameter to BadRequestError in `src/BadRequestError.ts`
- **depends on:** task.1.6
- **acceptance criteria:**
  - `BadRequestError<TMetadata>` accepts type parameter
  - default `= HelpfulErrorMetadata` preserves backwards compat
  - extends `HelpfulError<TMetadata>`
- **verification:**
  ```sh
  npm run test:types && npm run test:unit -- BadRequestError.test.ts
  ```
  - expect: types pass, all tests pass


### task.2.2 = update UnexpectedCodePathError subclass
- [ ] **execute:** add generic type parameter to UnexpectedCodePathError in `src/UnexpectedCodePathError.ts`
- **depends on:** task.1.6
- **acceptance criteria:**
  - `UnexpectedCodePathError<TMetadata>` accepts type parameter
  - default `= HelpfulErrorMetadata` preserves backwards compat
  - extends `HelpfulError<TMetadata>`
- **verification:**
  ```sh
  npm run test:types && npm run test:unit -- UnexpectedCodePathError.test.ts
  ```
  - expect: types pass, all tests pass


### task.2.3 = verify all prior tests pass
- [ ] **execute:** run full test suite
- **depends on:** task.2.1, task.2.2
- **acceptance criteria:**
  - all tests in entire suite pass
  - no regressions introduced
- **verification:**
  ```sh
  npm run test
  ```
  - expect: all tests pass


---

## phase.3 = metadata getter tests

### task.3.1 = add metadata getter tests
- [ ] **execute:** add `describe('metadata', ...)` block to `src/HelpfulError.test.ts`
- **depends on:** task.2.3
- **acceptance criteria:**
  - test: `error.metadata` returns the metadata object
  - test: `error.metadata` returns undefined when no metadata
  - test: `Object.keys(error)` does not contain 'metadata'
  - test: `JSON.stringify(error)` does not contain top-level 'metadata' key
- **verification:**
  ```sh
  npm run test:unit -- HelpfulError.test.ts
  ```
  - expect: all tests pass


---

## phase.4 = typed generic constraint tests

### task.4.1 = add typed generic constraint tests
- [ ] **execute:** add `describe('typed metadata generic', ...)` block to `src/HelpfulError.test.ts`
- **depends on:** task.3.1
- **acceptance criteria:**
  - test: valid metadata compiles and works
  - test: `@ts-expect-error` on wrong key
  - test: `@ts-expect-error` on wrong type
  - test: `@ts-expect-error` on nonexistent property access
  - test: nested typed metadata works
  - test: `@ts-expect-error` on wrong metadata for static throw
- **verification:**
  ```sh
  npm run test:types && npm run test:unit -- HelpfulError.test.ts
  ```
  - expect: types pass (ts-expect-error valid), tests pass


### task.4.2 = add backwards compatibility tests
- [ ] **execute:** add `describe('backwards compatibility', ...)` block to `src/HelpfulError.test.ts`
- **depends on:** task.4.1
- **acceptance criteria:**
  - test: `HelpfulError` without generic works
  - test: cause in metadata without generic works
- **verification:**
  ```sh
  npm run test:unit -- HelpfulError.test.ts
  ```
  - expect: all tests pass


---

## phase.5 = subclass typed metadata tests

### task.5.1 = add BadRequestError typed metadata tests
- [ ] **execute:** add `describe('typed metadata generic', ...)` block to `src/BadRequestError.test.ts`
- **depends on:** task.4.2
- **acceptance criteria:**
  - test: `BadRequestError<{ field: string }>` works
  - test: `error.metadata?.field` returns correct value
  - test: `@ts-expect-error` on wrong key
- **verification:**
  ```sh
  npm run test:types && npm run test:unit -- BadRequestError.test.ts
  ```
  - expect: types pass, tests pass


### task.5.2 = add UnexpectedCodePathError typed metadata tests
- [ ] **execute:** add `describe('typed metadata generic', ...)` block to `src/UnexpectedCodePathError.test.ts`
- **depends on:** task.4.2
- **acceptance criteria:**
  - test: `UnexpectedCodePathError<{ field: string }>` works
  - test: `error.metadata?.field` returns correct value
  - test: `@ts-expect-error` on wrong key
- **verification:**
  ```sh
  npm run test:types && npm run test:unit -- UnexpectedCodePathError.test.ts
  ```
  - expect: types pass, tests pass


---

## phase.6 = final verification

### task.6.1 = run full test suite
- [ ] **execute:** run all tests
- **depends on:** task.5.1, task.5.2
- **acceptance criteria:**
  - all unit tests pass
  - all snapshots unchanged (or updated if expected)
- **verification:**
  ```sh
  npm run test
  ```
  - expect: all tests pass


### task.6.2 = run full type check
- [ ] **execute:** run type check
- **depends on:** task.6.1
- **acceptance criteria:**
  - no type errors
  - all `@ts-expect-error` annotations are valid (would error without them)
- **verification:**
  ```sh
  npm run test:types
  ```
  - expect: exit code 0


### task.6.3 = run lint check
- [ ] **execute:** run lint
- **depends on:** task.6.2
- **acceptance criteria:**
  - no lint errors
- **verification:**
  ```sh
  npm run test:lint
  ```
  - expect: exit code 0


### task.6.4 = run build
- [ ] **execute:** compile typescript
- **depends on:** task.6.3
- **acceptance criteria:**
  - build succeeds
  - dist output generated
- **verification:**
  ```sh
  npm run build
  ```
  - expect: exit code 0


---

## dependency graph

```
phase.1 (core)
  task.1.1 → task.1.2 → task.1.3 → task.1.4 → task.1.5 → task.1.6
                                                              ↓
phase.2 (subclasses)                                          ↓
  task.1.6 → task.2.1 ──────────────────────────────────┬─→ task.2.3
  task.1.6 → task.2.2 ──────────────────────────────────┘     ↓
                                                              ↓
phase.3 (getter tests)                                        ↓
  task.2.3 → task.3.1 ────────────────────────────────────────↓
                                                              ↓
phase.4 (generic tests)                                       ↓
  task.3.1 → task.4.1 → task.4.2 ─────────────────────────────↓
                                                              ↓
phase.5 (subclass tests)                                      ↓
  task.4.2 → task.5.1 ──────────────────────────────────┬─────↓
  task.4.2 → task.5.2 ──────────────────────────────────┘     ↓
                                                              ↓
phase.6 (final)                                               ↓
  task.5.1 + task.5.2 → task.6.1 → task.6.2 → task.6.3 → task.6.4
```


---

## completion checklist

- [ ] phase.1 complete (core HelpfulError changes)
- [ ] phase.2 complete (subclass updates)
- [ ] phase.3 complete (metadata getter tests)
- [ ] phase.4 complete (typed generic constraint tests)
- [ ] phase.5 complete (subclass typed metadata tests)
- [ ] phase.6 complete (final verification)


---

## usecase coverage map

| usecase (from criteria) | covered by |
|-------------------------|------------|
| access typed metadata via getter | task.3.1 |
| constrain metadata input via generic | task.4.1 |
| backwards compatibility | task.4.2 |
| stringify without redundant metadata | task.3.1 |
| subclasses with typed metadata | task.5.1, task.5.2 |
| type inference validation via ts-expect-error | task.4.1, task.5.1, task.5.2 |
